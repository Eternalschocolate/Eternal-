<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eternal Chocolate Bars — Timeless Indulgence</title>
    
    <!-- SEO & Social Media Meta Tags -->
    <meta name="description" content="Eternal Chocolate Bars – timeless, luxurious, handcrafted from single-origin cacao. Discover a piece of eternity.">
    <meta name="keywords" content="dark chocolate, luxury chocolate, Eternal Bars, artisan cacao, handcrafted chocolate, single-origin">
    <meta property="og:title" content="Eternal Chocolate Bars — Timeless Indulgence" />
    <meta property="og:description" content="Discover handcrafted, single-origin chocolate that transcends time. Each bar is a timeless experience." />
    <meta property="og:image" content="https://placehold.co/1200x630/0c1445/d4af37?text=Eternal" />
    <meta name="twitter:card" content="summary_large_image" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        /* --- Custom Properties & Base Styles --- */
        :root {
            --midnight-blue: #0c1445;
            --ivory-cream: #f5f5dc;
            --gold-foil: #d4af37;
            --gold-foil-dark: #b48811;
            --gold-foil-light: #fef4a9;
        }

        body {
            background-color: var(--midnight-blue);
            color: var(--ivory-cream);
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
            cursor: default;
        }
        
        /* --- Typography & Effects --- */
        .font-brand { font-family: 'Cinzel Decorative', serif; }

        .gold-foil-text {
            background: linear-gradient(145deg, var(--gold-foil-light), var(--gold-foil), var(--gold-foil-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .celestial-bg {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.04'%3E%3Ccircle cx='50' cy='50' r='0.5'/%3E%3Ccircle cx='10' cy='10' r='0.5'/%3E%3Ccircle cx='90' cy='90' r='0.5'/%3E%3Ccircle cx='10' cy='90' r='0.25'/%3E%3Ccircle cx='90' cy='10' r='0.25'/%3E%3Ccircle cx='30' cy='70' r='0.5'/%3E%3Ccircle cx='70' cy='30' r='0.5'/%3E%3C/g%3E%3C/svg%3E");
        }
        
        /* --- Interactive Elements --- */
        .cursor-glow {
            position: fixed;
            left: 0;
            top: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.2), transparent 70%);
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s;
            z-index: 9999;
            display: none; 
        }
        @media (pointer: fine) {
            .cursor-glow { display: block; }
        }
        
        #scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: var(--gold-foil);
            width: 0%;
            z-index: 100;
        }

        .btn-gold {
            border: 1px solid var(--gold-foil);
            color: var(--gold-foil);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .btn-gold:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background-color: var(--gold-foil);
            transition: all 0.3s ease;
            z-index: -1;
        }
        .btn-gold:hover {
            color: var(--midnight-blue);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }
        .btn-gold:hover:before {
            left: 0;
        }
        
        /* --- Navigation --- */
        .nav-link.active {
            color: var(--gold-foil);
            position: relative;
        }
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 1px;
            background-color: var(--gold-foil);
        }
        
        /* --- Product Card Styling (from hmmm.html) --- */
        .product-card {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(245, 245, 220, 0.1);
        }
        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(212, 175, 55, 0.2);
        }
        .product-card .top-section {
            flex: 2;
            background-color: var(--midnight-blue);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.08'%3E%3Ccircle cx='50' cy='50' r='0.5'/%3E%3Ccircle cx='10' cy='10' r='0.5'/%3E%3Ccircle cx='90' cy='90' r='0.5'/%3E%3C/g%3E%3C/svg%3E");
            color: var(--gold-foil);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
        }
        .product-card .bottom-section {
            flex: 1.2;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            padding: 20px;
            color: var(--ivory-cream);
        }
        .product-card .logo { font-family: 'Cinzel Decorative', serif; font-size: 28px; }
        .product-card .subtitle { font-size: 8px; letter-spacing: 3px; text-transform: uppercase; opacity: 0.8; }
        
        /* --- Utilities --- */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-active { opacity: 1; transform: scale(1); transition: all 300ms ease-out; }
        .modal-leave { opacity: 0; transform: scale(0.95); transition: all 300ms ease-in; }

    </style>
</head>
<body class="celestial-bg">

    <!-- Scroll Progress & Cursor -->
    <div id="scroll-progress"></div>
    <div class="cursor-glow"></div>

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-midnight-blue/80 backdrop-blur-sm border-b border-ivory-cream/10">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" onclick="navigateTo('home')" class="font-brand text-3xl gold-foil-text tracking-wider">Eternal</a>
            <nav class="hidden md:flex items-center space-x-8">
                <a href="#" onclick="navigateTo('home')" class="nav-link text-ivory-cream hover:text-gold-foil transition-colors duration-300 active" data-page="home">Home</a>
                <a href="#" onclick="navigateTo('shop')" class="nav-link text-ivory-cream hover:text-gold-foil transition-colors duration-300" data-page="shop">Shop</a>
                <a href="#" onclick="navigateTo('about')" class="nav-link text-ivory-cream hover:text-gold-foil transition-colors duration-300" data-page="about">About</a>
                <a href="#" onclick="navigateTo('contact')" class="nav-link text-ivory-cream hover:text-gold-foil transition-colors duration-300" data-page="contact">Contact</a>
            </nav>
            <div class="flex items-center space-x-4">
                 <div id="user-actions">
                    <button onclick="openAuthModal('signin')" class="text-ivory-cream hover:text-gold-foil transition-colors text-sm">Sign In</button>
                    <button onclick="openAuthModal('signup')" class="btn-gold px-4 py-1.5 rounded-full text-sm">Sign Up</button>
                </div>
                 <div id="user-profile" class="hidden relative">
                     <button class="w-8 h-8 bg-gold-foil/20 rounded-full flex items-center justify-center text-gold-foil font-bold" onclick="toggleProfileDropdown()">
                         <span id="user-initial"></span>
                     </button>
                     <div id="profile-dropdown" class="absolute top-12 right-0 bg-midnight-blue border border-ivory-cream/10 rounded-md w-48 hidden">
                         <a href="#" class="block px-4 py-2 hover:bg-ivory-cream/5">Order History</a>
                         <a href="#" id="logout-btn" class="block px-4 py-2 hover:bg-ivory-cream/5 text-red-400">Logout</a>
                     </div>
                 </div>
                <button onclick="toggleCart()" class="relative">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-ivory-cream hover:text-gold-foil transition-colors"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                    <span id="cart-badge" class="absolute -top-2 -right-2 bg-gold-foil text-midnight-blue text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold opacity-0 scale-0 transition-all duration-300">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-20">
        <!-- Home Page -->
        <div id="home" class="page-content">
            <section class="min-h-screen flex items-center justify-center text-center px-6 relative overflow-hidden">
                <div id="parallax-container" class="absolute inset-0 z-0">
                   <div class="absolute top-0 left-0 w-full h-full bg-cover opacity-20" style="background-image: url('https://placehold.co/1920x1080/0c1445/d4af37?text=+'); transform: scale(1.2);"></div>
                </div>
                <div class="relative z-10" data-aos="fade-up">
                    <div class="shimmer-effect mb-12 inline-block">
                        <img src="https://placehold.co/400x200/0000/d4af37.png?text=ETERNAL" alt="Eternal Chocolate Bar" class="w-80 md:w-96">
                    </div>
                    <h1 class="font-brand text-4xl md:text-6xl tracking-wider leading-tight">Some moments are meant to last forever.</h1>
                    <p class="mt-6 text-lg text-ivory-cream/80 max-w-2xl mx-auto">Discover chocolate that transcends time. Crafted from the finest single-origin cacao, each bar is a timeless experience.</p>
                    <button onclick="navigateTo('shop')" class="btn-gold px-10 py-3 mt-12 rounded-full text-lg tracking-wider">Discover Eternal</button>
                </div>
            </section>
        </div>

        <!-- Shop Page -->
        <div id="shop" class="page-content hidden">
            <section class="container mx-auto px-6 py-16">
                <div data-aos="fade-down">
                    <h2 class="font-brand text-5xl text-center mb-4">Our Collection</h2>
                    <p class="text-center text-ivory-cream/70 mb-12">Select a piece of eternity to savor.</p>
                    <div class="flex justify-center flex-wrap gap-4 mb-12" id="filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="dark">Dark</button>
                        <button class="filter-btn" data-filter="milk">Milk</button>
                        <button class="filter-btn" data-filter="white">White</button>
                        <button class="filter-btn" data-filter="limited">Limited</button>
                    </div>
                </div>
                <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                    <!-- Product cards will be injected here by JS -->
                </div>
            </section>
        </div>

        <!-- About Page -->
        <div id="about" class="page-content hidden">
             <section class="container mx-auto px-6 py-16" data-aos="fade-up">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="font-brand text-5xl mb-6">Our Story</h2>
                    <p class="text-lg leading-relaxed text-ivory-cream/80 mb-12">
                        Eternal was born from a simple vision: to create a chocolate experience that feels timeless. We believe that the right flavor, at the right moment, can create a memory that lasts forever. Our journey takes us to the world's finest cacao farms, sourcing single-origin beans that tell a story of their own, from the misty mountains of Peru to the sun-drenched fields of Madagascar.
                    </p>
                    <div class="bg-ivory-cream/5 rounded-lg p-8 my-12 border border-ivory-cream/10">
                        <p class="text-2xl italic font-light text-gold-foil">"Crafted from the soul of the cacao bean — a piece of eternity for you to savor."</p>
                    </div>
                    <img src="https://placehold.co/800x400/0c1445/f5f5dc?text=Crafting+Process" alt="Crafting Process" class="rounded-lg shadow-2xl mx-auto">
                </div>
            </section>
        </div>

        <!-- Contact Page -->
        <div id="contact" class="page-content hidden">
            <section class="container mx-auto px-6 py-16" data-aos="fade-up">
                <div class="max-w-2xl mx-auto text-center">
                    <h2 class="font-brand text-5xl mb-4">Get In Touch</h2>
                    <p class="text-ivory-cream/70 mb-12">We'd love to hear from you. For inquiries, collaborations, or just to share a timeless moment.</p>
                    <form id="contact-form" class="space-y-6">
                        <input type="text" placeholder="Your Name" class="w-full bg-ivory-cream/5 border border-ivory-cream/20 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-gold-foil transition">
                        <input type="email" placeholder="Your Email" class="w-full bg-ivory-cream/5 border border-ivory-cream/20 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-gold-foil transition">
                        <textarea placeholder="Your Message" rows="5" class="w-full bg-ivory-cream/5 border border-ivory-cream/20 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-gold-foil transition"></textarea>
                        <button type="submit" class="btn-gold w-full py-3 rounded-md text-lg">Send Message</button>
                    </form>
                    <div id="contact-success" class="hidden mt-6 p-4 bg-green-500/10 border border-green-500/30 text-green-300 rounded-md">Thank you! Your message has been sent.</div>
                </div>
            </section>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-ivory-cream/5 py-12 mt-16">
        <div class="container mx-auto px-6 text-center text-ivory-cream/60">
            <div class="flex justify-center space-x-8 mb-6">
                <a href="#" onclick="navigateTo('home')" class="hover:text-gold-foil transition">Home</a>
                <a href="#" onclick="navigateTo('shop')" class="hover:text-gold-foil transition">Shop</a>
                <a href="#" onclick="navigateTo('about')" class="hover:text-gold-foil transition">About</a>
                <a href="#" onclick="navigateTo('contact')" class="hover:text-gold-foil transition">Contact</a>
            </div>
            <p class="font-brand text-2xl gold-foil-text mb-2">Eternal</p>
            <p class="text-sm">&copy; 2025 Eternal Chocolate Bars. All Rights Reserved. ∞</p>
        </div>
    </footer>
    
    <!-- Modals & Sidebars -->
    <!-- Authentication Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black/70 z-[51] hidden flex items-center justify-center p-4 modal-enter">
        <div class="bg-midnight-blue rounded-lg shadow-xl w-full max-w-md p-8 relative celestial-bg" id="auth-modal-content">
            <!-- Auth form injected here -->
        </div>
    </div>
    
    <!-- Product Detail Modal -->
    <div id="product-detail-modal" class="fixed inset-0 bg-black/70 z-[52] hidden flex items-center justify-center p-4 modal-enter">
        <div id="product-detail-content" class="bg-midnight-blue rounded-lg shadow-xl w-full max-w-4xl h-[90vh] max-h-[700px] relative celestial-bg flex flex-col md:flex-row overflow-y-auto hide-scrollbar">
            <!-- Product details injected here -->
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full max-w-md bg-midnight-blue shadow-2xl transform translate-x-full transition-transform duration-500 ease-in-out z-[53] flex flex-col">
        <div class="p-6 flex justify-between items-center border-b border-ivory-cream/10">
            <h3 class="font-brand text-2xl">Your Cart</h3>
            <button onclick="toggleCart()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-ivory-cream hover:text-gold-foil"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <div id="cart-items" class="flex-grow p-6 overflow-y-auto hide-scrollbar">
            <p id="empty-cart-message" class="text-center text-ivory-cream/50 mt-10">Your cart is empty.</p>
            <!-- Cart items injected here -->
        </div>
        <div class="p-6 border-t border-ivory-cream/10">
            <div class="flex justify-between items-center text-lg mb-4">
                <span>Subtotal</span>
                <span id="cart-subtotal" class="font-semibold">₹0.00</span>
            </div>
            <button id="checkout-btn" class="btn-gold w-full py-3 rounded-md hidden">Proceed to Checkout</button>
        </div>
    </div>
    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-[52] hidden" onclick="toggleCart()"></div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-black/70 z-[54] hidden flex items-center justify-center p-4 modal-enter">
        <div class="bg-midnight-blue rounded-lg shadow-xl w-full max-w-lg p-8 relative celestial-bg">
            <button onclick="closeModal('checkout-modal')" class="absolute top-4 right-4 text-ivory-cream/50 hover:text-gold-foil text-2xl">&times;</button>
            <div id="checkout-content-wrapper">
                <!-- Checkout content injected here -->
            </div>
        </div>
    </div>


<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    // --- DATA ---
    const products = [
        { id: 1, name: 'Timeless Dark', description: '60% Cacao with rich, earthy notes.', price: 250, category: 'dark', color: '#800020', cacao: 60, story: 'A classic, profound flavor that stands the test of time.' },
        { id: 2, name: 'Midnight Milk', description: 'Creamy & Smooth, a dreamy escape.', price: 220, category: 'milk', color: '#c0844f', cacao: 45, story: 'As comforting as a starry night sky.' },
        { id: 3, name: 'Caramel Eclipse', description: 'With a touch of Himalayan Sea Salt.', price: 280, category: 'milk', color: '#ff7f50', cacao: 50, story: 'A perfect alignment of sweet and savory.' },
        { id: 4, name: 'Supernova', description: 'White Chocolate & Raspberry bursts.', price: 300, category: 'white', color: '#ffc0cb', cacao: 35, story: 'An explosion of cosmic fruitiness.' },
        { id: 5, name: 'Cosmic Mint', description: 'Dark Chocolate with a refreshing nebula of mint.', price: 260, category: 'dark', color: '#2E8B57', cacao: 65, story: 'Cool, crisp, and infinitely deep.' },
        { id: 6, name: 'Orion Orange', description: 'Dark Chocolate & Zesty Orange peel.', price: 260, category: 'dark', color: '#FFA500', cacao: 62, story: 'A bright constellation of citrus in a dark sky.' },
        { id: 7, name: 'Galaxy Hazelnut', description: 'Milk chocolate with roasted hazelnuts.', price: 290, category: 'milk', color: '#8B4513', cacao: 48, story: 'A crunchy journey through a creamy galaxy.' },
        { id: 8, name: 'Void 99%', description: 'Intensely dark, for the true connoisseur.', price: 350, category: 'dark', color: '#1a1a1a', cacao: 99, story: 'Embrace the pure, powerful darkness of the cosmos.' },
        { id: 9, name: 'Celestial Crunch', description: 'Limited Edition with popping candy.', price: 320, category: 'limited', color: '#483D8B', cacao: 55, story: 'Feel the stars explode on your tongue.' },
    ];
    let cart = [];
    let currentUser = null;

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        AOS.init({ once: true, duration: 800 });
        loadCartFromStorage();
        checkUserSession();
        renderProducts();
        updateCartUI();
        navigateTo('home');
        setupEventListeners();
    });

    function setupEventListeners() {
        // Cursor Glow
        document.addEventListener('mousemove', e => {
            const cursor = document.querySelector('.cursor-glow');
            if (cursor) {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            }
        });
        
        // Scroll Progress
        window.addEventListener('scroll', () => {
            const scrollTop = document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            document.getElementById('scroll-progress').style.width = `${(scrollTop / scrollHeight) * 100}%`;
        });

        // Parallax Hero
        window.addEventListener('scroll', () => {
            const parallax = document.querySelector('#parallax-container div');
            if (parallax) {
                parallax.style.transform = `translateY(${window.pageYOffset * 0.3}px) scale(1.2)`;
            }
        });
        
        // Logout
        document.getElementById('logout-btn').addEventListener('click', e => { e.preventDefault(); logout(); });
        
        // Product Filters
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                document.querySelector('.filter-btn.active').classList.remove('active', 'bg-ivory-cream/10', 'text-gold-foil', 'border-gold-foil');
                e.target.classList.add('active', 'bg-ivory-cream/10', 'text-gold-foil', 'border-gold-foil');
                renderProducts(e.target.dataset.filter);
            });
            button.classList.add('px-4', 'py-1', 'rounded-full', 'border', 'border-ivory-cream/20', 'hover:bg-ivory-cream/10', 'transition', 'text-sm');
        });
        document.querySelector('.filter-btn.active').classList.add('bg-ivory-cream/10', 'text-gold-foil', 'border-gold-foil');
        
        // Contact Form
        document.getElementById('contact-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const successMessage = document.getElementById('contact-success');
            successMessage.classList.remove('hidden');
            e.target.reset();
            setTimeout(() => successMessage.classList.add('hidden'), 4000);
        });

        // Checkout Button
        document.getElementById('checkout-btn').addEventListener('click', () => {
            toggleCart();
            openCheckout();
        });
    }

    // --- NAVIGATION ---
    function navigateTo(pageId) {
        document.querySelectorAll('.page-content').forEach(p => p.classList.add('hidden'));
        document.getElementById(pageId)?.classList.remove('hidden');
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.toggle('active', link.dataset.page === pageId);
        });
        window.scrollTo(0, 0);
    }
    
    // --- MODAL & SIDEBAR CONTROLS ---
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('hidden');
        setTimeout(() => modal.classList.add('modal-active'), 10);
    }
    
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('modal-active');
        modal.classList.add('modal-leave');
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('modal-leave');
        }, 300);
    }
    
    function toggleCart() {
        document.getElementById('cart-sidebar').classList.toggle('translate-x-full');
        document.getElementById('cart-overlay').classList.toggle('hidden');
    }

    // --- SHOP & PRODUCT RENDERING ---
    function renderProducts(filter = 'all') {
        const productGrid = document.getElementById('product-grid');
        productGrid.innerHTML = '';
        const filtered = filter === 'all' ? products : products.filter(p => p.category === filter);

        filtered.forEach((product, index) => {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.setAttribute('data-aos', 'fade-up');
            card.setAttribute('data-aos-delay', (index % 4) * 100);
            card.innerHTML = `
                <div class="top-section">
                    <div class="logo">ETERNAL</div>
                    <div class="subtitle">CHOCOLATE BARS</div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-24">
                        <svg viewBox="0 0 100 100" class="opacity-80"><circle cx="50" cy="50" r="30" stroke="#d4af37" stroke-width="1.5" fill="none"/><circle cx="50" cy="50" r="25" stroke="#d4af37" stroke-width="1" stroke-dasharray="3 3" fill="none"/></svg>
                    </div>
                </div>
                <div class="bottom-section" style="background-color: ${product.color};">
                    <div>
                        <h3 class="font-brand text-2xl">${product.name}</h3>
                        <p class="text-ivory-cream/80 text-sm mb-4">${product.description.split('.')[0]}.</p>
                        <p class="text-xl font-semibold mb-4">₹${product.price.toFixed(2)}</p>
                    </div>
                    <div class="w-full flex gap-2 mt-auto">
                        <button onclick="openProductDetail(${product.id})" class="flex-1 border border-ivory-cream/50 text-ivory-cream/80 hover:bg-ivory-cream/10 rounded-full py-2 transition text-sm">View</button>
                        <button onclick="addToCart(${product.id})" class="flex-1 bg-ivory-cream text-midnight-blue hover:bg-gold-foil rounded-full py-2 transition font-semibold text-sm">Add</button>
                    </div>
                </div>
            `;
            productGrid.appendChild(card);
        });
    }
    
    // --- PRODUCT DETAIL MODAL ---
    function openProductDetail(productId) {
        const product = products.find(p => p.id === productId);
        if (!product) return;
        
        document.getElementById('product-detail-content').innerHTML = `
            <button onclick="closeModal('product-detail-modal')" class="absolute top-4 right-4 text-ivory-cream/50 hover:text-gold-foil text-2xl z-10">&times;</button>
            <div class="w-full md:w-1/2 h-64 md:h-full flex items-center justify-center p-8" style="background-color: ${product.color}">
                 <div class="text-center">
                    <div class="logo text-4xl text-white opacity-80">ETERNAL</div>
                    <div class="font-brand text-4xl mt-4 text-white">${product.name}</div>
                 </div>
            </div>
            <div class="w-full md:w-1/2 p-8 flex flex-col">
                <h2 class="font-brand text-4xl text-gold-foil">${product.name}</h2>
                <p class="text-ivory-cream/70 mt-2">${product.description}</p>
                <div class="my-6 border-t border-ivory-cream/10"></div>
                <div class="space-y-4 text-lg">
                    <p><strong class="text-gold-foil/80">Cacao:</strong> ${product.cacao}% Single-Origin</p>
                    <p><strong class="text-gold-foil/80">Story:</strong> <span class="italic text-ivory-cream/80">"${product.story}"</span></p>
                </div>
                <div class="mt-auto pt-8">
                     <p class="text-3xl text-gold-foil font-semibold mb-6 text-right">₹${product.price.toFixed(2)}</p>
                    <button onclick="addToCart(${product.id}, 1, true)" class="btn-gold w-full py-3 rounded-md text-lg">Add to Cart</button>
                </div>
            </div>
        `;
        openModal('product-detail-modal');
    }

    // --- AUTHENTICATION ---
    function openAuthModal(type) {
        const content = document.getElementById('auth-modal-content');
        const isSigningUp = type === 'signup';
        content.innerHTML = `
            <button onclick="closeModal('auth-modal')" class="absolute top-4 right-4 text-ivory-cream/50 hover:text-gold-foil text-2xl">&times;</button>
            <h3 class="font-brand text-3xl text-center mb-6">${isSigningUp ? 'Join the Eternal Circle' : 'Welcome Back'}</h3>
            <form id="auth-form" class="space-y-4">
                ${isSigningUp ? '<input type="text" id="name" required placeholder="Your Name" class="w-full bg-ivory-cream/5 p-3 rounded-md border border-ivory-cream/20 focus:outline-none focus:ring-1 focus:ring-gold-foil">' : ''}
                <input type="email" id="email" required placeholder="Email Address" class="w-full bg-ivory-cream/5 p-3 rounded-md border border-ivory-cream/20 focus:outline-none focus:ring-1 focus:ring-gold-foil">
                <input type="password" id="password" required placeholder="Password" class="w-full bg-ivory-cream/5 p-3 rounded-md border border-ivory-cream/20 focus:outline-none focus:ring-1 focus:ring-gold-foil">
                <p id="auth-error" class="text-red-400 text-sm hidden"></p>
                <button type="submit" class="btn-gold w-full py-3 mt-4 rounded-md">${isSigningUp ? 'Create Account' : 'Sign In'}</button>
            </form>
            <p class="text-center text-sm mt-4 text-ivory-cream/70">
                ${isSigningUp ? 'Already have an account?' : "Don't have an account?"}
                <a href="#" onclick="openAuthModal('${isSigningUp ? 'signin' : 'signup'}')" class="text-gold-foil hover:underline">${isSigningUp ? 'Sign In' : 'Sign Up'}</a>
            </p>
        `;
        openModal('auth-modal');
        document.getElementById('auth-form').addEventListener('submit', (e) => { e.preventDefault(); handleAuth(type); });
    }

    function handleAuth(type) {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const name = type === 'signup' ? document.getElementById('name').value : null;
        const errorEl = document.getElementById('auth-error');

        if(password.length < 6) {
            errorEl.textContent = 'Password must be at least 6 characters.';
            errorEl.classList.remove('hidden');
            return;
        }
        errorEl.classList.add('hidden');

        if (type === 'signup') {
            const newUser = { name, email };
            localStorage.setItem('eternal_user', JSON.stringify(newUser));
            login(newUser);
        } else {
            const storedUser = JSON.parse(localStorage.getItem('eternal_user'));
            if(storedUser && storedUser.email === email) login(storedUser);
            else {
                errorEl.textContent = 'Invalid credentials. Please try again.';
                errorEl.classList.remove('hidden');
            }
        }
    }
    
    function login(user) {
        currentUser = user;
        document.getElementById('user-actions').classList.add('hidden');
        document.getElementById('user-profile').classList.remove('hidden');
        document.getElementById('user-initial').textContent = user.name.charAt(0).toUpperCase();
        closeModal('auth-modal');
    }
    
    function logout() {
        currentUser = null;
        localStorage.removeItem('eternal_user');
        document.getElementById('user-actions').classList.remove('hidden');
        document.getElementById('user-profile').classList.add('hidden');
        toggleProfileDropdown(true);
    }
    
    function checkUserSession() {
        const storedUser = JSON.parse(localStorage.getItem('eternal_user'));
        if (storedUser) login(storedUser);
    }
    
    function toggleProfileDropdown(forceClose = false) {
        document.getElementById('profile-dropdown').classList.toggle('hidden', forceClose);
    }

    // --- CART LOGIC ---
    function addToCart(productId, quantity = 1, fromDetail = false) {
        const product = products.find(p => p.id === productId);
        const cartItem = cart.find(item => item.id === productId);
        if (cartItem) cartItem.quantity += quantity;
        else cart.push({ ...product, quantity });
        if(fromDetail) closeModal('product-detail-modal');
        updateCartUI();
        saveCartToStorage();
        if(!fromDetail) toggleCart();
    }
    
    function updateCartUI() {
        const cartItemsContainer = document.getElementById('cart-items');
        const emptyMsg = document.getElementById('empty-cart-message');
        const checkoutBtn = document.getElementById('checkout-btn');
        const badge = document.getElementById('cart-badge');
        
        if (cart.length === 0) {
            emptyMsg.classList.remove('hidden');
            checkoutBtn.classList.add('hidden');
            cartItemsContainer.innerHTML = '';
        } else {
            emptyMsg.classList.add('hidden');
            checkoutBtn.classList.remove('hidden');
            cartItemsContainer.innerHTML = cart.map(item => `
                <div class="flex items-center justify-between mb-4">
                    <img src="https://placehold.co/60x30/${item.color.substring(1)}/f5f5dc" alt="${item.name}" class="rounded-sm">
                    <div class="ml-4 flex-grow">
                        <p class="font-semibold">${item.name}</p>
                        <p class="text-sm text-ivory-cream/50">₹${item.price.toFixed(2)}</p>
                    </div>
                    <div class="flex items-center">
                        <input type="number" value="${item.quantity}" min="1" onchange="updateQuantity(${item.id}, this.value)" class="w-12 bg-ivory-cream/10 text-center rounded-md border border-ivory-cream/20">
                        <button onclick="removeFromCart(${item.id})" class="ml-3 text-ivory-cream/50 hover:text-red-500 text-xl">&times;</button>
                    </div>
                </div>
            `).join('');
        }
        
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

        if(totalItems > 0) {
            badge.textContent = totalItems;
            badge.classList.remove('opacity-0', 'scale-0');
        } else {
            badge.classList.add('opacity-0', 'scale-0');
        }
        document.getElementById('cart-subtotal').textContent = `₹${subtotal.toFixed(2)}`;
    }
    
    function updateQuantity(productId, quantity) {
        const cartItem = cart.find(item => item.id === productId);
        if (cartItem) {
            cartItem.quantity = parseInt(quantity);
            if(cartItem.quantity <= 0) removeFromCart(productId);
            else { updateCartUI(); saveCartToStorage(); }
        }
    }
    
    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        updateCartUI();
        saveCartToStorage();
    }
    
    function saveCartToStorage() { localStorage.setItem('eternal_cart', JSON.stringify(cart)); }
    function loadCartFromStorage() { cart = JSON.parse(localStorage.getItem('eternal_cart')) || []; }
    
    // --- CHECKOUT LOGIC ---
    function openCheckout() {
        const wrapper = document.getElementById('checkout-content-wrapper');
        const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        wrapper.innerHTML = `
            <h3 class="font-brand text-3xl text-center mb-6">Checkout</h3>
            <form id="payment-form" class="space-y-4">
                <h4 class="text-lg font-semibold border-b border-ivory-cream/10 pb-2 mb-4">Shipping Information</h4>
                <input type="text" required placeholder="Full Name" class="w-full bg-ivory-cream/5 p-2 rounded-md border border-ivory-cream/20 focus:outline-none focus:ring-1 focus:ring-gold-foil">
                <input type="text" required placeholder="Address" class="w-full bg-ivory-cream/5 p-2 rounded-md border border-ivory-cream/20 focus:outline-none focus:ring-1 focus:ring-gold-foil">
                <div class="flex space-x-4">
                    <input type="text" required placeholder="City" class="w-full bg-ivory-cream/5 p-2 rounded-md border border-ivory-cream/20 focus:outline-none focus:ring-1 focus:ring-gold-foil">
                    <input type="text" required placeholder="Pincode" class="w-full bg-ivory-cream/5 p-2 rounded-md border border-ivory-cream/20 focus:outline-none focus:ring-1 focus:ring-gold-foil">
                </div>
                 <h4 class="text-lg font-semibold border-b border-ivory-cream/10 pb-2 pt-4">Payment</h4>
                 <div class="text-right text-xl pt-4">Total: <span class="text-gold-foil font-bold">₹${subtotal.toFixed(2)}</span></div>
                 <button type="submit" class="btn-gold w-full py-3 mt-4 rounded-md">Place Order</button>
            </form>
        `;
        openModal('checkout-modal');
        document.getElementById('payment-form').addEventListener('submit', handleOrderPlacement);
    }
    
    function handleOrderPlacement(e) {
        e.preventDefault();
        const wrapper = document.getElementById('checkout-content-wrapper');
        wrapper.innerHTML = `
            <div class="text-center py-10">
                <svg class="w-16 h-16 text-gold-foil mx-auto mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h4 class="font-brand text-2xl mb-2">Thank You!</h4>
                <p class="text-ivory-cream/70">Your order is confirmed. A piece of eternity is on its way.</p>
            </div>
        `;
        cart = [];
        updateCartUI();
        saveCartToStorage();
        setTimeout(() => closeModal('checkout-modal'), 4000);
    }

</script>

</body>

</html>
